#!/bin/bash

# Pre-installation script for Roadworthy Lens
# This script runs before package installation

PACKAGE_NAME="RoadworthyLens"
USER="roadworthylens"
GROUP="roadworthylens"

# Check if Node.js is available
if ! command -v node &> /dev/null; then
    echo "Error: Node.js is required but not found on this system."
    echo "Please install Node.js through Package Center first:"
    echo "1. Open Package Center"
    echo "2. Search for 'Node.js'"
    echo "3. Install Node.js v16 or later"
    exit 1
fi

# Check Node.js version
NODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)
if [ "$NODE_VERSION" -lt 16 ]; then
    echo "Error: Node.js version 16 or later is required."
    echo "Current version: $(node -v)"
    echo "Please update Node.js through Package Center."
    exit 1
fi

# Create service user if it doesn't exist
if ! id -u ${USER} > /dev/null 2>&1; then
    echo "Creating service user: ${USER}"
    addgroup ${GROUP}
    adduser --disabled-password --gecos "" --ingroup ${GROUP} ${USER}
fi

echo "Pre-installation checks completed successfully"
exit 0